<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pacific Pulse AI Chatbot - Embed</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }

    /* Chatbot container */
    #pacific-pulse-chatbot {
      position: fixed;
      bottom: 20px;
      right: 20px;
      z-index: 999999;
    }

    /* Chat button */
    .chat-button {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: linear-gradient(135deg, #2563eb, #9333ea);
      border: none;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      display: flex;
      align-items: center;
      justify-content: center;
      transition: transform 0.2s;
    }

    .chat-button:hover {
      transform: scale(1.1);
    }

    .chat-button svg {
      width: 28px;
      height: 28px;
      color: white;
    }

    .status-dot {
      position: absolute;
      top: -2px;
      right: -2px;
      width: 16px;
      height: 16px;
      background: #10b981;
      border-radius: 50%;
      border: 3px solid white;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    /* Chat window */
    .chat-window {
      display: none;
      position: fixed;
      bottom: 90px;
      right: 20px;
      width: 380px;
      max-width: calc(100vw - 40px);
      height: 600px;
      max-height: calc(100vh - 120px);
      background: white;
      border-radius: 16px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
      flex-direction: column;
      overflow: hidden;
    }

    .chat-window.open {
      display: flex;
    }

    /* Chat header */
    .chat-header {
      background: linear-gradient(135deg, #2563eb, #9333ea);
      color: white;
      padding: 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .chat-header-info {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .chat-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.2);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 14px;
    }

    .chat-title h3 {
      font-size: 16px;
      margin-bottom: 2px;
    }

    .chat-title p {
      font-size: 12px;
      opacity: 0.9;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .online-dot {
      width: 8px;
      height: 8px;
      background: #10b981;
      border-radius: 50%;
      animation: pulse 2s infinite;
    }

    .close-button {
      background: none;
      border: none;
      color: white;
      cursor: pointer;
      padding: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.2s;
      border-radius: 8px;
    }

    .close-button:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    .close-button svg {
      width: 20px;
      height: 20px;
    }

    /* Chat messages */
    .chat-messages {
      flex: 1;
      overflow-y: auto;
      padding: 16px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .message {
      display: flex;
      align-items: flex-start;
      gap: 8px;
    }

    .message.user {
      flex-direction: row-reverse;
    }

    .message-content {
      max-width: 75%;
      padding: 12px 16px;
      border-radius: 16px;
      font-size: 14px;
      line-height: 1.5;
      white-space: pre-wrap;
    }

    .message.user .message-content {
      background: #2563eb;
      color: white;
      border-bottom-right-radius: 4px;
    }

    .message.assistant .message-content {
      background: #f3f4f6;
      color: #1f2937;
      border-bottom-left-radius: 4px;
    }

    .typing {
      display: flex;
      gap: 4px;
      padding: 12px 16px;
      background: #f3f4f6;
      border-radius: 16px;
      border-bottom-left-radius: 4px;
      max-width: 60px;
    }

    .typing span {
      width: 8px;
      height: 8px;
      background: #9ca3af;
      border-radius: 50%;
      animation: typing 1.4s infinite;
    }

    .typing span:nth-child(2) {
      animation-delay: 0.2s;
    }

    .typing span:nth-child(3) {
      animation-delay: 0.4s;
    }

    @keyframes typing {
      0%, 60%, 100% { transform: translateY(0); }
      30% { transform: translateY(-8px); }
    }

    /* Chat input */
    .chat-input {
      padding: 16px;
      border-top: 1px solid #e5e7eb;
      display: flex;
      gap: 8px;
    }

    .chat-input input {
      flex: 1;
      padding: 12px 16px;
      border: 1px solid #d1d5db;
      border-radius: 24px;
      font-size: 14px;
      outline: none;
      transition: border-color 0.2s;
    }

    .chat-input input:focus {
      border-color: #2563eb;
    }

    .chat-input input:disabled {
      background: #f9fafb;
      cursor: not-allowed;
    }

    .send-button {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: #2563eb;
      border: none;
      color: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.2s;
    }

    .send-button:hover:not(:disabled) {
      background: #1d4ed8;
    }

    .send-button:disabled {
      background: #9ca3af;
      cursor: not-allowed;
    }

    .send-button svg {
      width: 18px;
      height: 18px;
    }

    /* Powered by */
    .powered-by {
      text-align: center;
      padding: 8px;
      font-size: 11px;
      color: #6b7280;
      border-top: 1px solid #e5e7eb;
    }

    .powered-by a {
      color: #2563eb;
      text-decoration: none;
      font-weight: 500;
    }

    .powered-by a:hover {
      text-decoration: underline;
    }

    /* Mobile responsive */
    @media (max-width: 480px) {
      .chat-window {
        bottom: 0;
        right: 0;
        left: 0;
        width: 100%;
        height: 100vh;
        max-height: 100vh;
        border-radius: 0;
      }

      #pacific-pulse-chatbot {
        bottom: 16px;
        right: 16px;
      }
    }
  </style>
</head>
<body>

  <div id="pacific-pulse-chatbot">
    <!-- Chat Button -->
    <button class="chat-button" id="chatButton" aria-label="Open chat">
      <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"></path>
      </svg>
      <span class="status-dot"></span>
    </button>

    <!-- Chat Window -->
    <div class="chat-window" id="chatWindow">
      <!-- Header -->
      <div class="chat-header">
        <div class="chat-header-info">
          <div class="chat-avatar">PP</div>
          <div class="chat-title">
            <h3>Pacific Pulse AI</h3>
            <p>
              <span class="online-dot"></span>
              Online
            </p>
          </div>
        </div>
        <button class="close-button" id="closeButton" aria-label="Close chat">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>

      <!-- Messages -->
      <div class="chat-messages" id="chatMessages">
        <div class="message assistant">
          <div class="message-content">
            Aloha! ðŸŒº I help Hawaii businesses capture missed revenue with AI automation.<br><br>What's your biggest challenge - missed calls, content creation, or finding time to market?
          </div>
        </div>
      </div>

      <!-- Input -->
      <div class="chat-input">
        <input
          type="text"
          id="messageInput"
          placeholder="Type your message..."
          autocomplete="off"
        />
        <button class="send-button" id="sendButton" aria-label="Send message">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
          </svg>
        </button>
      </div>

      <!-- Powered by -->
      <div class="powered-by">
        Powered by <a href="https://pacific-pulse-growth-lab-production.up.railway.app" target="_blank">Pacific Pulse Growth Lab</a>
      </div>
    </div>
  </div>

  <script>
    // Configuration
    const API_URL = 'https://pacific-pulse-growth-lab-production.up.railway.app/api/chat';
    const MESSAGE_LIMIT = 20;

    // State
    let isOpen = false;
    let messages = [];
    let messageCount = 0;
    let isLoading = false;

    // DOM Elements
    const chatButton = document.getElementById('chatButton');
    const chatWindow = document.getElementById('chatWindow');
    const closeButton = document.getElementById('closeButton');
    const chatMessages = document.getElementById('chatMessages');
    const messageInput = document.getElementById('messageInput');
    const sendButton = document.getElementById('sendButton');

    // Toggle chat
    function toggleChat() {
      isOpen = !isOpen;
      if (isOpen) {
        chatWindow.classList.add('open');
        messageInput.focus();
      } else {
        chatWindow.classList.remove('open');
      }
    }

    // Add message to chat
    function addMessage(role, content) {
      const messageDiv = document.createElement('div');
      messageDiv.className = `message ${role}`;

      const contentDiv = document.createElement('div');
      contentDiv.className = 'message-content';
      contentDiv.textContent = content;

      messageDiv.appendChild(contentDiv);
      chatMessages.appendChild(messageDiv);

      // Scroll to bottom
      chatMessages.scrollTop = chatMessages.scrollHeight;

      messages.push({ role, content });
    }

    // Show typing indicator
    function showTyping() {
      const typingDiv = document.createElement('div');
      typingDiv.className = 'typing';
      typingDiv.id = 'typingIndicator';
      typingDiv.innerHTML = '<span></span><span></span><span></span>';
      chatMessages.appendChild(typingDiv);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    // Hide typing indicator
    function hideTyping() {
      const typingDiv = document.getElementById('typingIndicator');
      if (typingDiv) {
        typingDiv.remove();
      }
    }

    // Send message
    async function sendMessage() {
      const message = messageInput.value.trim();

      if (!message || isLoading) return;

      // Check message limit
      if (messageCount >= MESSAGE_LIMIT) {
        addMessage('assistant', `You've reached your ${MESSAGE_LIMIT}-message preview limit. Ready to capture those missed calls? Apply now: https://pacific-pulse-growth-lab-production.up.railway.app/apply`);
        return;
      }

      // Add user message
      addMessage('user', message);
      messageInput.value = '';
      messageCount++;

      // Show typing
      isLoading = true;
      messageInput.disabled = true;
      sendButton.disabled = true;
      showTyping();

      try {
        // Call API
        const response = await fetch(API_URL, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            messages: messages,
            industry: 'general'
          }),
        });

        if (!response.ok) {
          throw new Error('Failed to send message');
        }

        const data = await response.json();

        // Hide typing and add assistant message
        hideTyping();
        addMessage('assistant', data.message);
        messageCount++;

      } catch (error) {
        console.error('Chat error:', error);
        hideTyping();
        addMessage('assistant', 'Sorry, I encountered an error. Please try again or contact Sony directly at sony@pacificpulsegrowth.com');
      } finally {
        isLoading = false;
        messageInput.disabled = false;
        sendButton.disabled = false;
        messageInput.focus();
      }
    }

    // Event listeners
    chatButton.addEventListener('click', toggleChat);
    closeButton.addEventListener('click', toggleChat);
    sendButton.addEventListener('click', sendMessage);

    messageInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
      }
    });
  </script>

</body>
</html>
